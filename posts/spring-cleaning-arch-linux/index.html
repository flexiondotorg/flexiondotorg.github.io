<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Blog, Podcasts, Live Streams and Videos about Linux and Open Source with a focus on Ubuntu, Debian and NixOS."><meta name=author content="Martin Wimpress"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wimpress.com/104"><meta name=twitter:title content="Spring cleaning Arch Linux"><meta name=twitter:description content="How to clean up installed packages on Arch Linux."><meta name=twitter:site content="@m_wimpress"><meta name=msapplication-TileColor content="#00aba9"><meta name=theme-color content="#ffffff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=preload href=/css/style.css type=text/css as=style onload='this.rel="stylesheet"'><link rel=stylesheet href=/css/style.css type=text/css media=print onload='this.media="all"'><link rel=preload href=/css/fonts.css type=text/css as=style onload='this.rel="stylesheet"'><link rel=stylesheet href=/css/fonts.css type=text/css media=print onload='this.media="all"'><link rel=preload href=/css/syntax.css type=text/css as=style onload='this.rel="stylesheet"'><link rel=stylesheet href=/css/syntax.css type=text/css media=print onload='this.media="all"'><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css type=text/css as=font onload='this.rel="stylesheet"' crossorigin=anonymous referrerpolicy=no-referrer integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css type=text/css media=print onload='this.media="all"' crossorigin=anonymous referrerpolicy=no-referrer integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="><noscript><link rel=stylesheet href=/css/style.css type=text/css><link rel=stylesheet href=/css/fonts.css type=text/css><link rel=stylesheet href=/css/syntax.css type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css type=text/css crossorigin=anonymous referrerpolicy=no-referrer integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="></noscript><title>Spring cleaning Arch Linux</title></head><body><nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id=mainNav><div class=container><a class=navbar-brand href=/>Martin Wimpress</a>
<button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type=button data-bs-toggle=collapse data-bs-target=#navbarResponsive aria-controls=navbarResponsive aria-expanded=false aria-label="Toggle navigation">
Menu
<em class="fas fa-bars"></em></button><div class="collapse navbar-collapse" id=navbarResponsive><ul class="navbar-nav ms-auto"><li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://wimpress.com/posts/>Posts</a></li><li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://wimpress.com/projects/>Projects</a></li></ul></div></div></nav><header class="masthead2 text-white text-center"></header><div class="container pb-5"><div class=row><section class="page-section portfolio col-12 col-lg-10"><img class="card-img-top rounded" src=https://wimpress.com/posts/spring-cleaning-arch-linux/hero.webp width=1080 height=580 alt="How to clean up installed packages on Arch Linux." loading=lazy><h2 class="page-section-heading text-center text-uppercase text-secondary mt-5">Spring cleaning Arch Linux</h2><div class="divider-custom m-0"><div class=divider-custom-line></div><div class=divider-custom-icon><em class="fas fa-file-text"></em></div><div class=divider-custom-line></div></div><div class="row mb-3"><div class="col text-center text-nowrap"><a class=h4 href=/tags/arch-linux/ title="Arch Linux"><span class="badge bg-primary p-2 m-1">Arch Linux</span></a>
<a class=h4 href=/tags/packer/ title=packer><span class="badge bg-primary p-2 m-1">packer</span></a>
<a class=h4 href=/tags/pacman/ title=pacman><span class="badge bg-primary p-2 m-1">pacman</span></a></div></div><div class="row justify-content-left"><div class=col-12><div class="alert alert-warning" role=alert><h4 class=alert-heading>Old post detected! <em class="fa-solid fa-person-cane"></em></h4><p>This post was last updated on 2013-05-07 which was about 3515 days ago! The information presented here may be out of date and inaccurate.</p><hr><small class=mb-0>Please read this page keeping its age in mind.</small></div></div><p>About a year ago I migrated all my workstations, laptops and netbooks to
<a href=http://www.archlinux.org>Arch Linux</a>. Since then, I&rsquo;ve setup Arch Linux
on a <a href=http://www.raspberrypi.org>Raspberry Pi</a> and this server was also
recently migrated to Arch Linux.</p><p>I&rsquo;ve had no major issues issues during the last year and have upgraded through
five major Linux kernels, transitioned to <code>systemd</code> and upgraded from GNOME 3.2
to 3.8.</p><p>Although I have been disciplined about <a href=https://wiki.archlinux.org/index.php/Pacnew_and_Pacsave_Files>merging <code>.pacnew</code> files</a>
frequently, during the upgrades and experimentation&rsquo;s I have packages installed
that I no longer require and obsolete files kicking about.</p><p>After the upgrade to GNOME 3.8 I decided to clean up a little. I rarely dip
into the AUR, but when I do I always use <a href=https://aur.archlinux.org/packages/packer/><code>packer</code></a>
to clearly separate what is official from what is not.</p><h2 id=finding-what-is-installed>Finding what is installed</h2><p>The following commands are useful for identifying installed packages based on
where they were installed from. The package lists generated from the commands below
can be quite big but often highlight packages that I know I&rsquo;m no longer using nor
require.</p><h3 id=listing-installed-packages>Listing installed packages</h3><p>List packages installed from the official repositories.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -Qq | grep -Fv -f &lt;(pacman -Qqm)
</span></span></code></pre></div><p>List packages installed from the AUR.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -Qqm
</span></span></code></pre></div><h3 id=listing-installed-packages-by-size>Listing installed packages by size</h3><p>Use <code>pacsysclean</code> to list installed packages sorted by size, it helps identify
large packages that are no longer required which can the be manually uninstalled.</p><h3 id=listing-orphaned-packages>Listing orphaned packages</h3><p>List orphaned packages install from the official repositories.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -Qqtd | grep -Fv -f &lt;(pacman -Qqtdm)
</span></span></code></pre></div><p>List ophaned packages from the AUR.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -Qqmtd
</span></span></code></pre></div><h3 id=getting-package-information>Getting package information</h3><p>Get package information for a package in the official repositories.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -Si &lt;package&gt;
</span></span></code></pre></div><p>Get package information for a package in the AUR.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>packer -Si &lt;package&gt;
</span></span></code></pre></div><h2 id=removing-orphaned-packages>Removing orphaned packages</h2><p>Removing orphaned packages manually can be very time consuming, but is by far the
safer option. However, I decided to take a brave pill a uninstall all orphaned
packages automatically.</p><p>Remove all orphaned packages installed from the official repositories.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -Rs <span style=color:#87ceeb>`</span>pacman -Qqtd | grep -Fv -f &lt;(pacman -Qqtdm)<span style=color:#87ceeb>`</span>
</span></span></code></pre></div><p>Remove all ophanced packages install from the AUR.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -Rs <span style=color:red>$(</span>pacman -Qqtdm<span style=color:red>)</span>
</span></span></code></pre></div><h2 id=re-installing-what-you-do-need>Re-installing what you do need</h2><p>When you do something scary like removing all the obsolete packages automatically,
then you should really make sure you do have everything install that you require.</p><h3 id=re-install-64-bit-base>Re-install 64-bit base</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -S --needed <span style=color:#87ceeb>`</span>pacman -Sqg base multilib-devel | grep -v gcc-libs | tr <span style=color:#87ceeb>&#39;\n&#39;</span> <span style=color:#87ceeb>&#39; &#39;</span><span style=color:#87ceeb>`</span>
</span></span></code></pre></div><h3 id=re-install-32-bit-base>Re-install 32-bit base</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -S --needed <span style=color:#87ceeb>`</span>pacman -Sqg base base-devel | tr <span style=color:#87ceeb>&#39;\n&#39;</span> <span style=color:#87ceeb>&#39; &#39;</span><span style=color:#87ceeb>`</span>
</span></span></code></pre></div><p>Reinstall the groups required for a GNOME 3 desktop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -S --needed <span style=color:#87ceeb>`</span>pacman -Sqg gnome gnome-extra telepathy | tr <span style=color:#87ceeb>&#39;\n&#39;</span> <span style=color:#87ceeb>&#39; &#39;</span><span style=color:#87ceeb>`</span>
</span></span></code></pre></div><p>Install all missing dependencies for packages in the official repositories.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo pacman -S --needed <span style=color:#87ceeb>`</span>pacman -Si <span style=color:#eedd82>$@</span> 2&gt;/dev/null | awk -F <span style=color:#87ceeb>&#34;: &#34;</span> -v <span style=color:#eedd82>filter</span>=<span style=color:#87ceeb>&#34;^Depends&#34;</span> <span style=color:#87ceeb>\ </span><span style=color:#87ceeb>&#39;$0 ~ filter {gsub(/[&gt;=&lt;][^ ]*/,&#34;&#34;,$2) ; gsub(/ +/,&#34;\n&#34;,$2) ; print $2}&#39;</span> | grep -v smtp- | sort -u<span style=color:#87ceeb>`</span>
</span></span></code></pre></div><p>Install all missing dependencies for packages in the AUR. This will re-install even if the
package is already installed. I can&rsquo;t be arsed to filter it out for a one liner.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo packer -S --noedit --noconfirm <span style=color:#87ceeb>`</span>packer -Si <span style=color:red>$(</span>pacman -Qqm<span style=color:red>)</span> 2&gt;/dev/null | awk -F <span style=color:#87ceeb>&#34;: &#34;</span> -v <span style=color:#eedd82>filter</span>=<span style=color:#87ceeb>&#34;^Depends&#34;</span> <span style=color:#87ceeb>\ </span><span style=color:#87ceeb>&#39;$0 ~ filter {gsub(/[&gt;=&lt;][^ ]*/,&#34;&#34;,$2) ; gsub(/ +/,&#34;\n&#34;,$2) ; print $2}&#39;</span> | grep -v java- | sort -u<span style=color:#87ceeb>`</span>
</span></span></code></pre></div><h2 id=find-files-not-associated-with-a-package>Find files not associated with a package</h2><p>When packages are removed they may leave some files behind. The following will find all files
not associated with a package. These files can <em>not</em> be automatically deleted, each entry
requires assessment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -Qlq | sort -u &gt; /tmp/db
</span></span><span style=display:flex><span>sudo find /bin /etc /sbin /usr ! -name lost+found <span style=color:#87ceeb>\(</span> -type d -printf <span style=color:#87ceeb>&#39;%p/\n&#39;</span> -o -print <span style=color:#87ceeb>\)</span> | sort &gt; /tmp/fs
</span></span><span style=display:flex><span>comm -23 /tmp/fs /tmp/db
</span></span></code></pre></div><p>As with all spring cleaning chores, I got bored by this stage as my workstation
was looking pretty tidy. Much of what is presented in this blog post is a rehash
of what others have already contributed to the <a href=https://wiki.archlinux.org/>Arch Linux Wiki</a>.
I&rsquo;ve just organised what &ldquo;<em>Works For Me</em> ™&rdquo; so I know what to do next year.</p><h4 id=references>References</h4><ul><li><a href=https://wiki.archlinux.org/index.php/Pacman_Tips>https://wiki.archlinux.org/index.php/Pacman_Tips</a></li></ul><div class="row mt-5 mb-3"><div class="col-6 text-left"><a class="btn btn-primary btn-lg col-12" href=https://wimpress.com/posts/python-distributions/><span class=h2><em class="fa fa-chevron-circle-left" aria-hidden=true></em></span></a></div><div class="col-6 text-right"><a class="btn btn-primary btn-lg col-12" href=https://wimpress.com/posts/get-iplayer-on-debian-6.0/><span class=h2><em class="fa fa-chevron-circle-right" aria-hidden=true></em></span></a></div></div></div></section><section class="page-section portfolio col-12 col-lg-2 my-3"><div id=sidebar class=fixed><div class="widget pt-3"><h4 class="mb-3 widget-title">Latest Posts</h4><ul class=list-unstyled><li class="d-flex my-1"><a href=https://wimpress.com/posts/diy-snes-classic/><h5>DIY SNES Classic</h5></a></li><li class="d-flex my-1"><a href=https://wimpress.com/posts/raspberry-pi-3-nextcloud-box-running-on-ubuntu-core/><h5>Raspberry Pi 3 Nextcloud Box running on Ubuntu Core</h5></a></li><li class="d-flex my-1"><a href=https://wimpress.com/posts/hp-microserver-n54l-power-saving-and-performance-tuning-using-debian/><h5>HP Microserver N54L power saving and performance tuning using Debian</h5></a></li></ul></div><div class="widget pt-3"><h4 class="mb-3 widget-title">Related Posts</h4><ul class=list-unstyled><li class="d-flex my-1"><a href=https://wimpress.com/projects/arch-linux/><h5>Arch Linux</h5></a></li><li class="d-flex my-1"><a href=https://wimpress.com/posts/sketchup-make-on-arch-linux/><h5>SketchUp Make on Arch Linux</h5></a></li><li class="d-flex my-1"><a href=https://wimpress.com/posts/nullmailer-on-arch-linux/><h5>nullmailer on Arch Linux</h5></a></li></ul></div></div></section></div></div><footer class="footer text-center"><div class=container><div class=row><div class="col-lg-4 mb-5 mb-lg-0"><h3 class="text-uppercase mb-4">Social</h3><a class="btn btn-outline-light btn-social mx-1" href=https://wimpysworld.io/discord aria-label=discord target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-discord"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://fosstodon.org/@wimpy aria-label=mastodon target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-mastodon"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://twitter.com/m_wimpress aria-label=twitter target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-twitter"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://linkedin.com/in/martinwimpress aria-label=linkedin target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-linkedin"></em></a></div><div class="col-lg-4 mb-5 mb-lg-0"><h3 class="text-uppercase mb-4">Code</h3><a class="btn btn-outline-light btn-social mx-1" href=https://github.com/flexiondotorg aria-label=github target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-github"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://launchpad.net/~flexiondotorg aria-label=ubuntu target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-ubuntu"></em></a></div><div class=col-lg-4><h3 class="text-uppercase mb-4">Content</h3><a class="btn btn-outline-light btn-social mx-1" href=https://instagram.com/WimpysWorld aria-label=instagram target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-instagram"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://twitch.tv/WimpysWorld aria-label=twitch target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-twitch"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://youtube.com/WimpysWorld aria-label=youtube target=_blank rel="noopener noreferrer"><em class="fab fa-fw fa-youtube"></em></a>
<a class="btn btn-outline-light btn-social mx-1" href=https://linuxdowntime.com aria-label=podcast target=_blank rel="noopener noreferrer"><em class="fas fa-fw fa-podcast"></em></a></div></div></div></footer><div class="copyright py-4 text-center text-white"><div class=container><small>Copyright &copy; Martin Wimpress 2022</small></div></div><script defer src=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.min.js type=text/javascript integrity="sha512-OvBgP9A2JBgiRad/mM36mkzXSXaJE9BEIENnVEmeZdITvwT09xnxLtT4twkCa8m/loMbPHsvPl0T8lRGVBwjlQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script defer src=/js/scripts.js type=text/javascript></script></body></html>